
name: Rijn Waterstanden Agent

on:
  schedule:
    # GitHub cron = UTC
    - cron: "0 5-19 * * *"   # 06–20 NL wintertijd (UTC+1)
    - cron: "0 4-18 * * *"   # 06–20 NL zomertijd (UTC+2)
  workflow_dispatch:

jobs:
  run-agent:
    runs-on: ubuntu-latest

    steps:
      - name: Repository uitchecken
        uses: actions/checkout@v4

      - name: Python installeren
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Dependencies installeren
        run: |
          pip install requests twilio

      # Mag falen bij eerste run
      - name: Vorige trenddata ophalen (artifact)
        continue-on-error: true
        uses: actions/download-artifact@v4
        with:
          name: last-values
          path: .

      # ✅ ENIGE WhatsApp die nog wordt verstuurd
      - name: Agent uitvoeren
        env:
          TWILIO_SID: ${{ secrets.TWILIO_SID }}
          TWILIO_AUTH: ${{ secrets.TWILIO_AUTH }}
        run: |
          python rijnagent.py

      - name: Trenddata opslaan (artifact)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: last-values
          path: last_values.json
          if-no-files-found: ignore
          retention-days: 14
