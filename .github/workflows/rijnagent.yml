
name: Rijn Waterstanden Agent

on:
  schedule:
    # GitHub cron = UTC
    # NL wintertijd (CET = UTC+1): 06–20 uur → 05–19
    - cron: "0 5-19 * * *"
    # NL zomertijd (CEST = UTC+2): 06–20 uur → 04–18
    - cron: "0 4-18 * * *"
  workflow_dispatch:

jobs:
  run-agent:
    runs-on: ubuntu-latest

    steps:
      - name: Repository uitchecken
        uses: actions/checkout@v4

      - name: Python installeren
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Dependencies installeren
        run: |
          pip install requests twilio

      # ✅ JUISTE manier: download mag falen bij 1e run
      - name: Vorige trenddata ophalen (artifact)
        continue-on-error: true
        uses: actions/download-artifact@v4
        with:
          name: last-values
          path: .

      - name: Agent uitvoeren
        env:
          TWILIO_SID: ${{ secrets.TWILIO_SID }}
          TWILIO_AUTH: ${{ secrets.TWILIO_AUTH }}
        run: |
          python rijnagent.py

      - name: Trenddata opslaan (artifact)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: last-values
          path: last_values.json
          if-no-files-found: ignore
          retention-days: 14
